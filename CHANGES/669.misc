move update type detecting to Update
